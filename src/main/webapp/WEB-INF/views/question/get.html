<!DOCTYPE html>
<html lang="en">
<head th:replace="includes/header.html :: head">
</head>
<body>

<!-- Navigation-->
<div th:insert="includes/navbar.html  :: nav">  </div>
<div class="container">
    <h3 th:text="${{question.id}+'번 질문'}">#번 질문</h3>
    <hr>
    <form role="form" th:action="${'/question/remove/' + {question.id}}" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <div class="mt-4 form-group">
            <label class="mb-2">제목</label>
            <input type="text" th:value="${question.subject}" name="subject" class="form-control" readonly="true">
        </div>
        <div class="mt-4 form-group">
            <label class="mb-2">내용</label>
            <textarea name="content" th:text="${question.content}" class="form-control" rows="3" readonly="true"></textarea>
        </div>
        <button type="button" class="mt-4 btn btn-primary mb-2" th:onclick="|location.href='@{/question/modify/{questionId}(questionId=${question.id})}'|" >수정하기</button>
        <button type="submit" class="mt-4 btn btn-danger mb-2">삭제하기</button>
    </form>

    <h4 class="mt-3" th:text="${#lists.size(answerList)}+'개의 답변이 있습니다.'"></h4>
    <hr>

    <div id="textarea-container" th:each="answer : ${answerList}">
        <form class="answer-form" role="form" action="/hi" th:answerId="${answer.id}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <div class="mt-4 form-group">
                <input type="number" hidden th:value="${answer.id}" name="id" class="form-control" readonly="true" th:answerId="${answer.id}">
            </div>
            <div class="mt-4 form-group">
                <input type="number" hidden th:value="${question.id}" name="question_id" class="form-control" readonly="true" th:answerId="${answer.id}">
            </div>
            <textarea name="content" th:text="${answer.content}" class="mt-3 form-control" rows="5" th:answerId="${answer.id}"></textarea>
            <button type="submit" id="modify" data-oper="modify" th:answerId="${answer.id}">수정</button>
            <button type="submit" id="delete" data-oper="delete" th:answerId="${answer.id}">삭제</button>
        </form>
    </div>

    <form role="form" action="/answer/create" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <div class="mt-4 form-group">
            <input type="number" hidden th:value="${question.id}" name="question_id" class="form-control" readonly="true">
        </div>
        <div class="mt-4 form-group">
            <textarea name="content"  class="mt-3 form-control" rows="5" placeholder="답변을 입력해주세요"></textarea>
        </div>
        <button type="submit" class="mt-4 btn btn-primary mb-2">답변 등록</button>
    </form>
</div>
</body>
<script>
    $(document).ready(function () {

        $('button#modify, button#delete').on("click", function(e){

            e.preventDefault();
            var answerId = $(this).attr("answerId")
            var formObj = $(`form[answerId=${answerId}]`)
            var operation = $(this).data("oper");
            var input = $(`input[answerId=${answerId}]`).clone()
            var textarea = $(`textarea[answerId=${answerId}]`).clone()
            console.log("디버깅", input);


            var textareaValue = $(`textarea[answerId=${answerId}]`).val();
            console.log("필요 엔서 아이디",answerId);
            console.log("필요 액션 종류",operation);
            console.log("필요 컨텐츠", textareaValue);

            if(operation === 'delete'){
                formObj.attr("action", `/answer/remove/${answerId}`).attr("method", "post");
                formObj.append(input);
            }else if(operation ==='modify'){
                formObj.attr("action", "/answer/modify").attr("method", "post");

                formObj.empty();

                formObj.append(input);
                formObj.append(textarea);
            }
            formObj.submit();
        })
    })
</script>
</html>
